---
title: "smart scheduling"
author: "Jakob Richter"
date: "18.11.2015"
output: html_document
---

```{r batchJobs}
library(BatchExperiments)
library(data.table)
reg = loadRegistry("~/lido_nobackup/rambo/")
reducer = function(job, res){
  res.dt = cbind(
    prob = job$prob.id,
    algo = job$algo.id,
    repl = job$repl,
    seed = job$seed,
    setNames(job$prob.pars, paste0("probpar.", names(job$prob.pars))),
    setNames(job$algo.pars, paste0("algopar.", names(job$algo.pars))),
    t(setNames(res$performance, paste0("test.", names(res$performance)))),
    tune.y = res$model$learner.model$opt.result$mbo.result$y,
    do.call(cbind, setNames(res$model$learner.model$opt.result$mbo.result$x, paste0("x.", names(res$model$learner.model$opt.result$mbo.result$x)))),
    as.data.frame(res$model$learner.model$opt.result$mbo.result$opt.path))
}
res.list = reduceResultsList(reg, fun = reducer)
res.dt = rbindlist(res.list, fill = TRUE)
head(res.dt)
```

```{r buildIdString}

```

Analyze runtimes
```{r}
end.res = res.dt[, .SD[1,], by = .(prob, algo, repl, probpar.fold, algopar.infill.crit, algopar.infill.crit.lcb.multiple, algopar.iters, algopar.multipoint.method, algopar.propose.points, algopar.schedule.method, algopar.schedule.priority, algopar.schedule.priority.time, fold)]
g = ggplot(res.dt, aes(x = exec.time , y = y, color = selected.learner))
g = g + geom_point()
g = g + geom_hline(data = end.res, mapping = aes(yintercept = test.mmce, color = x.selected.learner), alpha = 0.5)
g = g + geom_text(data = end.res, mapping = aes(y = test.mmce, label = paste(algopar.infill.crit, algopar.infill.crit.lcb.multiple, algopar.iters, algopar.multipoint.method, algopar.propose.points, algopar.schedule.method, algopar.schedule.priority, algopar.schedule.priority.time)), size = 4, color = "black")
g + scale_x_log10(breaks = c(1, 10, 100, 1000)) + facet_grid(~probpar.fold)
```

